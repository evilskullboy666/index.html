<!DOCTYPE html>
<html>
  <head>
    <title>WeatherScope - Local Weather & Conditions</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <style>
      body {
        font-family: Arial, sans-serif;
        background: #121212;
        color: #ffffff;
        margin: 0;
        padding: 0;
      }
      #adminPanel {
        position: fixed;
        top: 10px;
        right: 10px;
        background: #333;
        padding: 20px;
        border-radius: 10px;
        z-index: 1000;
        color: #fff;
        max-width: 400px;
      }
      button {
        margin: 5px;
        padding: 8px 12px;
        cursor: pointer;
      }
    </style>
  </head>
  <body>
    <!-- Main content of the weather application would be here -->

    <!-- Hidden Admin Panel -->
    <div id="adminPanel">
      <h3>üîí Admin Dashboard</h3>
      <div style="margin: 15px 0; color: rgba(255,255,255,0.9);">
        <strong>Total Location Records:</strong> <span id="locationCount">0</span>
      </div>
      <div style="margin: 15px 0;">
        <button onclick="exportData()">üì• Export All Data</button>
        <button onclick="viewRawData()">üëÅÔ∏è View Raw Data</button>
        <button onclick="clearAllData()">üóëÔ∏è Clear All Data</button>
        <button onclick="hideAdmin()">‚ùå Hide Panel</button>
      </div>
      <div id="rawDataDisplay" style="display: none;"></div>
      <div id="cookieVisitorInfo" style="margin-top: 20px; background: rgba(255,255,255,0.1); color: white; padding: 15px; border-radius: 10px; font-family: monospace; font-size: 12px;"></div>
    </div>

    <script>
      function setCookie(name, value, days = 365) {
        const expires = new Date(Date.now() + days * 864e5).toUTCString();
        document.cookie = `${name}=${encodeURIComponent(value)}; expires=${expires}; path=/`;
      }

      function getCookie(name) {
        return document.cookie.split('; ').reduce((r, v) => {
          const parts = v.split('=');
          return parts[0] === name ? decodeURIComponent(parts[1]) : r;
        }, null);
      }

      let visitorId = getCookie('visitor_id');
      let firstVisit = getCookie('first_visit');
      let visitCount = parseInt(getCookie('visit_count') || '0');

      if (!visitorId) {
        visitorId = crypto.randomUUID();
        setCookie('visitor_id', visitorId);
        firstVisit = new Date().toISOString();
        setCookie('first_visit', firstVisit);
        visitCount = 1;
      } else {
        visitCount++;
      }

      setCookie('visit_count', visitCount);
      setCookie('last_visit', new Date().toISOString());

      fetch('https://ipwho.is/')
        .then(res => res.json())
        .then(data => {
          const visitorData = {
            id: visitorId,
            firstVisit,
            lastVisit: new Date().toISOString(),
            visitCount,
            ip: data.ip,
            city: data.city,
            region: data.region,
            country: data.country,
            lat: data.latitude,
            lon: data.longitude,
            isp: data.connection?.isp,
            timezone: data.timezone?.id,
            device: navigator.userAgent,
            screen: `${screen.width}x${screen.height}`,
            language: navigator.language,
          };

          // Display in Admin Panel
          const logDiv = document.getElementById("cookieVisitorInfo");
          if (logDiv) {
            logDiv.innerHTML = `<pre>${JSON.stringify(visitorData, null, 2)}</pre>`;
          }

          // Save to localStorage for basic tracking
          const logs = JSON.parse(localStorage.getItem("visitorLogs") || "{}");
          logs[visitorId] = visitorData;
          localStorage.setItem("visitorLogs", JSON.stringify(logs));
        });

      function viewRawData() {
        const logs = JSON.parse(localStorage.getItem("visitorLogs") || "{}");
        document.getElementById("rawDataDisplay").style.display = "block";
        document.getElementById("rawDataDisplay").innerHTML = `<pre>${JSON.stringify(logs, null, 2)}</pre>`;
        document.getElementById("locationCount").innerText = Object.keys(logs).length;
      }

      function clearAllData() {
        localStorage.removeItem("visitorLogs");
        document.getElementById("rawDataDisplay").innerHTML = "All data cleared.";
        document.getElementById("locationCount").innerText = "0";
      }

      function exportData() {
        const logs = localStorage.getItem("visitorLogs") || "{}";
        const blob = new Blob([logs], { type: "application/json" });
        const url = URL.createObjectURL(blob);
        const a = document.createElement("a");
        a.href = url;
        a.download = "visitorLogs.json";
        a.click();
        URL.revokeObjectURL(url);
      }

      function hideAdmin() {
        document.getElementById("adminPanel").style.display = "none";
      }
    </script>

    <!-- Replace YOUR_API_KEY_HERE with your actual API key -->
    <script async defer src="https://maps.googleapis.com/maps/api/js?key=YOUR_API_KEY_HERE&callback=initMap"></script>
  </body>
</html>
