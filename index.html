<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>WeatherScope - Local Weather & Admin Tools</title>
  <style>
    body {
      margin: 0;
      font-family: 'Segoe UI', sans-serif;
      background: linear-gradient(to bottom, #74b9ff, #dfe6e9);
      color: #2d3436;
    }
    header {
      background-color: #0984e3;
      color: white;
      padding: 2rem;
      box-shadow: 0 4px 10px rgba(0,0,0,0.2);
      text-align: center;
    }
    header h1 {
      margin: 0;
      font-size: 2.5rem;
    }
    #weatherBox {
      margin: 2rem auto;
      padding: 2rem;
      background: white;
      max-width: 500px;
      border-radius: 12px;
      box-shadow: 0 6px 15px rgba(0,0,0,0.1);
      text-align: center;
    }
    #map {
      height: 300px;
      width: 100%;
      max-width: 500px;
      margin: 2rem auto;
      border-radius: 12px;
    }
    #adminPanel {
      display: none;
      background: white;
      padding: 2rem;
      margin: 2rem auto;
      border-radius: 12px;
      box-shadow: 0 4px 20px rgba(0,0,0,0.1);
      max-width: 700px;
    }
    #adminPanel h2 {
      color: #0984e3;
    }
    #adminPanel button {
      background-color: #0984e3;
      color: white;
      border: none;
      padding: 10px 16px;
      margin: 5px;
      border-radius: 6px;
      cursor: pointer;
    }
    #rawDataDisplay {
      white-space: pre-wrap;
      background: #ecf0f1;
      padding: 1rem;
      border-radius: 10px;
      margin-top: 1rem;
      max-height: 200px;
      overflow-y: auto;
      font-size: 14px;
    }
    #loginModal {
      display: none;
      position: fixed;
      top: 0; left: 0;
      width: 100%; height: 100%;
      background: rgba(0,0,0,0.7);
      backdrop-filter: blur(5px);
      justify-content: center;
      align-items: center;
      z-index: 9999;
    }
    .login-box {
      background: white;
      padding: 2rem;
      border-radius: 15px;
      text-align: center;
      color: #000;
      max-width: 300px;
      width: 100%;
    }
    input {
      width: 100%;
      padding: 10px;
      margin-top: 10px;
      border-radius: 6px;
      border: 1px solid #ccc;
    }
  </style>
</head>
<body>
  <header>
    <h1>‚õÖ WeatherScope</h1>
    <p>Your local weather with ai enhancement</p>
  </header>

  <div id="weatherBox">
    <h2 id="location">Detecting location...</h2>
    <p><strong>Temperature:</strong> <span id="temp">--¬∞C</span></p>
    <p><strong>Condition:</strong> <span id="condition">Loading...</span></p>
  </div>

  <div id="map"></div>

  <div id="adminPanel">
    <h2>üîê Admin Panel</h2>
    <p>Total Location Records: <span id="locationCount">0</span></p>
    <button onclick="exportData()">üì• Export CSV</button>
    <button onclick="viewRawData()">üëÅÔ∏è View Raw Data</button>
    <button onclick="clearAllData()">üóëÔ∏è Clear All</button>
    <div id="rawDataDisplay" style="display:none;"></div>
  </div>

  <div id="loginModal">
    <div class="login-box">
      <h3>Admin Login</h3>
      <input id="adminUsername" type="text" placeholder="Username" />
      <input id="adminPassword" type="password" placeholder="Password" />
      <br/><br/>
      <button onclick="attemptLogin()">Login</button>
    </div>
  </div>

  <script>
    let map, marker;

    window.onload = function () {
      checkAdminAccess();
      fetch("https://ipapi.co/json/")
        .then(res => res.json())
        .then(data => {
          const lat = parseFloat(data.latitude);
          const lon = parseFloat(data.longitude);
          const city = data.city + ", " + data.region;
          document.getElementById("location").innerText = city;
          initMap(lat, lon);
          saveLocation(lat, lon);
          fetchWeather(lat, lon);
        })
        .catch(() => {
          document.getElementById("location").innerText = "Location unavailable";
        });
    };

    function initMap(lat, lng) {
      const pos = { lat, lng };
      map = new google.maps.Map(document.getElementById("map"), {
        center: pos,
        zoom: 12
      });
      marker = new google.maps.Marker({
        position: pos,
        map: map,
        title: "Your Location"
      });
    }

    function fetchWeather(lat, lon) {
      fetch(`https://api.open-meteo.com/v1/forecast?latitude=${lat}&longitude=${lon}&current_weather=true`)
        .then(response => response.json())
        .then(data => {
          document.getElementById("temp").innerText = data.current_weather.temperature + "¬∞C";
          const codes = ["Clear", "Mainly Clear", "Partly Cloudy", "Overcast"];
          document.getElementById("condition").innerText = codes[data.current_weather.weathercode] || "Cloudy";
        })
        .catch(() => {
          document.getElementById("condition").innerText = "Unable to fetch weather";
        });
    }

    function saveLocation(lat, lng) {
      const stored = JSON.parse(localStorage.getItem("locations") || "[]");
      stored.push({
        lat, lng,
        timestamp: new Date().toISOString()
      });
      localStorage.setItem("locations", JSON.stringify(stored));
    }

    function checkAdminAccess() {
      const urlParams = new URLSearchParams(window.location.search);
      if (urlParams.get("admin") === "secret") {
        showLoginModal();
      }
    }

    document.addEventListener("keydown", function (e) {
      if (e.ctrlKey && e.shiftKey && e.key === "A") {
        showLoginModal();
      }
    });

    function showLoginModal() {
      document.getElementById("loginModal").style.display = "flex";
    }

    function attemptLogin() {
      const user = document.getElementById("adminUsername").value;
      const pass = document.getElementById("adminPassword").value;
      if (user === "admin" && pass === "epic") {
        document.getElementById("loginModal").style.display = "none";
        document.getElementById("adminPanel").style.display = "block";
        updateLocationCount();
      } else {
        alert("Invalid credentials");
      }
    }

    function updateLocationCount() {
      const data = JSON.parse(localStorage.getItem("locations") || "[]");
      document.getElementById("locationCount").textContent = data.length;
    }

    function exportData() {
      const data = JSON.parse(localStorage.getItem("locations") || "[]");
      if (!data.length) return alert("No data to export");
      let csv = "Timestamp,Latitude,Longitude\n";
      data.forEach(d => {
        csv += `${d.timestamp},${d.lat},${d.lng}\n`;
      });
      const blob = new Blob([csv], { type: "text/csv" });
      const a = document.createElement("a");
      a.href = URL.createObjectURL(blob);
      a.download = "location_data.csv";
      a.click();
    }

    function viewRawData() {
      const box = document.getElementById("rawDataDisplay");
      const data = JSON.parse(localStorage.getItem("locations") || "[]");
      box.innerText = JSON.stringify(data, null, 2);
      box.style.display = box.style.display === "none" ? "block" : "none";
    }

    function clearAllData() {
      if (confirm("Delete all stored location data?")) {
        localStorage.removeItem("locations");
        updateLocationCount();
        document.getElementById("rawDataDisplay").style.display = "none";
      }
    }
  </script>

  <script async defer src="https://maps.googleapis.com/maps/api/js?key=AlzaSyB_Wf43YltG5wLQ9uPXtjhGc7bfAa9B09w"></script>
</body>
</html>
