
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>WeatherScope - Location Tracker</title>
  <style>
    body {
      margin: 0;
      font-family: 'Segoe UI', sans-serif;
      background: linear-gradient(135deg, #74b9ff, #0984e3);
      color: #fff;
      text-align: center;
    }
    header {
      padding: 2rem 1rem;
      background: rgba(255,255,255,0.1);
      backdrop-filter: blur(6px);
      box-shadow: 0 4px 10px rgba(0,0,0,0.2);
    }
    header h1 {
      margin: 0;
      font-size: 2.5rem;
      color: #fff;
    }
    #map {
      height: 400px;
      width: 100%;
      margin-top: 20px;
      border-radius: 12px;
      box-shadow: 0 4px 15px rgba(0,0,0,0.2);
    }
    #locationStatus {
      font-size: 1.2rem;
      margin: 1rem;
    }
    #adminPanel {
      display: none;
      background: rgba(255,255,255,0.1);
      margin: 2rem auto;
      padding: 1.5rem;
      border-radius: 15px;
      max-width: 800px;
      text-align: left;
    }
    #adminPanel h2 { color: #fff; }
    #adminPanel button {
      background: #fff;
      color: #0984e3;
      border: none;
      padding: 10px 16px;
      margin: 5px;
      border-radius: 8px;
      cursor: pointer;
    }
    #rawDataDisplay {
      white-space: pre-wrap;
      background: #333;
      color: #0f0;
      padding: 1rem;
      margin-top: 1rem;
      border-radius: 10px;
      max-height: 300px;
      overflow-y: auto;
    }
    #loginModal {
      display: none;
      position: fixed;
      top: 0; left: 0;
      width: 100%; height: 100%;
      background: rgba(0,0,0,0.7);
      backdrop-filter: blur(5px);
      justify-content: center;
      align-items: center;
      z-index: 9999;
    }
    .login-box {
      background: white;
      padding: 2rem;
      border-radius: 15px;
      text-align: center;
      color: #000;
      max-width: 300px;
      width: 100%;
    }
    input {
      width: 100%;
      padding: 10px;
      margin-top: 10px;
      border-radius: 6px;
      border: 1px solid #ccc;
    }
  </style>
</head>
<body>
  <header>
    <h1>üåê WeatherScope</h1>
    <p id="locationStatus">Attempting to get your location...</p>
  </header>
  <div id="map"></div>

  <!-- Admin Panel -->
  <div id="adminPanel">
    <h2>üîí Admin Panel</h2>
    <p>Total Records: <span id="locationCount">0</span></p>
    <button onclick="exportData()">üì• Export CSV</button>
    <button onclick="viewRawData()">üëÅÔ∏è View Raw Data</button>
    <button onclick="clearAllData()">üóëÔ∏è Clear All Data</button>
    <div id="rawDataDisplay" style="display:none;"></div>
  </div>

  <!-- Login Modal -->
  <div id="loginModal">
    <div class="login-box">
      <h3>Admin Login</h3>
      <input id="adminUsername" type="text" placeholder="Username" />
      <input id="adminPassword" type="password" placeholder="Password" />
      <br/><br/>
      <button onclick="attemptLogin()">Login</button>
    </div>
  </div>

  <script>
    let map;
    let marker;

    window.onload = function () {
      checkAdminAccess();
      initMap();
      getLocation();
    };

    function initMap(lat = 0, lng = 0) {
      const pos = { lat, lng };
      map = new google.maps.Map(document.getElementById("map"), {
        center: pos,
        zoom: lat === 0 ? 2 : 14
      });

      if (lat !== 0 && lng !== 0) {
        marker = new google.maps.Marker({
          position: pos,
          map,
          title: "You are here"
        });
      }
    }

    function getLocation() {
      const status = document.getElementById("locationStatus");
      if (!navigator.geolocation) {
        status.textContent = "Geolocation not supported.";
        return;
      }

      navigator.geolocation.getCurrentPosition(
        (position) => {
          const lat = position.coords.latitude;
          const lng = position.coords.longitude;
          status.textContent = `üìç Lat: ${lat.toFixed(4)}, Lng: ${lng.toFixed(4)}`;
          initMap(lat, lng);
          saveLocation(lat, lng);
        },
        () => {
          status.textContent = "Unable to retrieve location.";
        },
        { enableHighAccuracy: true, timeout: 10000 }
      );
    }

    function saveLocation(lat, lng) {
      const stored = JSON.parse(localStorage.getItem("locations") || "[]");
      stored.push({
        lat, lng,
        timestamp: new Date().toISOString()
      });
      localStorage.setItem("locations", JSON.stringify(stored));
    }

    function checkAdminAccess() {
      const urlParams = new URLSearchParams(window.location.search);
      if (urlParams.get("admin") === "secret") {
        showLoginModal();
      }
    }

    document.addEventListener("keydown", function (e) {
      if (e.ctrlKey && e.shiftKey && e.key === "A") {
        showLoginModal();
      }
    });

    function showLoginModal() {
      document.getElementById("loginModal").style.display = "flex";
    }

    function attemptLogin() {
      const user = document.getElementById("adminUsername").value;
      const pass = document.getElementById("adminPassword").value;
      if (user === "admin" && pass === "epic") {
        document.getElementById("loginModal").style.display = "none";
        document.getElementById("adminPanel").style.display = "block";
        updateLocationCount();
      } else {
        alert("Wrong login");
      }
    }

    function updateLocationCount() {
      const data = JSON.parse(localStorage.getItem("locations") || "[]");
      document.getElementById("locationCount").textContent = data.length;
    }

    function exportData() {
      const data = JSON.parse(localStorage.getItem("locations") || "[]");
      if (!data.length) return alert("No data to export");
      let csv = "Timestamp,Latitude,Longitude\n";
      data.forEach(d => {
        csv += `${d.timestamp},${d.lat},${d.lng}\n`;
      });
      const blob = new Blob([csv], { type: "text/csv" });
      const a = document.createElement("a");
      a.href = URL.createObjectURL(blob);
      a.download = "location_data.csv";
      a.click();
    }

    function viewRawData() {
      const box = document.getElementById("rawDataDisplay");
      const data = JSON.parse(localStorage.getItem("locations") || "[]");
      box.innerText = JSON.stringify(data, null, 2);
      box.style.display = box.style.display === "none" ? "block" : "none";
    }

    function clearAllData() {
      if (confirm("Delete all stored location data?")) {
        localStorage.removeItem("locations");
        updateLocationCount();
        document.getElementById("rawDataDisplay").style.display = "none";
      }
    }
  </script>
  <script async defer src="https://maps.googleapis.com/maps/api/js?key=AlzaSyB_Wf43YltG5wLQ9uPXtjhGc7bfAa9B09w
"></script>
</body>
</html>
