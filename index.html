<!DOCTYPE html>
<html>
  <head>
    <title>WeatherScope - Local Weather & Conditions</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <style>/* OMITTED: STYLES HERE */</style>
  </head>
  <body>
    <!-- OMITTED: HTML CONTENT -->
    <div style="text-align:center; margin: 20px;">
      <button onclick="getCurrentLocation()">üìç Get My Location</button>
    </div>

    <script>
      let map;
      let markers = [];

      window.onload = function () {
        checkAdminAccess();
        simulateWeatherData();
        initMap();
      };

      function initMap() {
        const defaultLocation = { lat: 0, lng: 0 };
        map = new google.maps.Map(document.getElementById("map"), {
          zoom: 2,
          center: defaultLocation
        });
      }

      function getCurrentLocation() {
        document.getElementById('locationName').textContent = 'üìç Detecting location...';
        
        if (navigator.geolocation) {
          navigator.geolocation.getCurrentPosition(
            (position) => {
              const loc = {
                lat: position.coords.latitude,
                lng: position.coords.longitude
              };
              map.setCenter(loc);
              map.setZoom(15);
              addMarker(loc);
              saveLocation(loc);
              updateLocationDisplay(loc);
            },
            (error) => {
              document.getElementById('locationName').textContent = 'üìç Location unavailable';
              console.error('Geolocation error:', error);
            },
            {
              enableHighAccuracy: true,
              timeout: 10000,
              maximumAge: 0
            }
          );
        } else {
          document.getElementById('locationName').textContent = 'üìç Geolocation not supported';
        }
      }
      function addMarker(location) {
        markers.forEach(marker => marker.setMap(null));
        markers = [];
        const marker = new google.maps.Marker({
          position: location,
          map: map,
          title: "Your Location"
        });
        markers.push(marker);
      }

      function updateLocationDisplay(loc) {
        document.getElementById('locationName').textContent = `üìç Lat: ${loc.lat.toFixed(4)}, Lng: ${loc.lng.toFixed(4)}`;
      }

      function saveLocation(loc) {
        let history = JSON.parse(localStorage.getItem('locationHistory')) || [];
        history.push({ ...loc, timestamp: new Date().toISOString() });
        if (history.length > 100) history = history.slice(-100);
        localStorage.setItem('locationHistory', JSON.stringify(history));
      }

      function simulateWeatherData() {
        setTimeout(() => {
          document.querySelector('.temp').textContent = '72¬∞F';
          document.querySelector('.condition').textContent = 'Partly Cloudy';
          document.querySelectorAll('.detail-item .value')[0].textContent = '65%';
          document.querySelectorAll('.detail-item .value')[1].textContent = '8 mph';
          document.querySelectorAll('.detail-item .value')[2].textContent = '1013 mb';
          document.querySelectorAll('.detail-item .value')[3].textContent = '10 mi';
        }, 2000);
      }

      // Admin functions (unchanged from your original version)
      function checkAdminAccess() {
        const urlParams = new URLSearchParams(window.location.search);
        if (urlParams.get('admin') === 'secret') {
          showLoginModal();
          return;
        }
      }

      document.addEventListener('keydown', function(event) {
        if (event.ctrlKey && event.shiftKey && event.key === 'A') {
          event.preventDefault();
          showLoginModal();
        }
      });

      function showLoginModal() {
        document.getElementById('loginModal').style.display = 'block';
        document.getElementById('adminUsername').focus();
      }

      function closeLoginModal() {
        document.getElementById('loginModal').style.display = 'none';
        document.getElementById('adminUsername').value = '';
        document.getElementById('adminPassword').value = '';
        document.getElementById('loginError').style.display = 'none';
      }

      function attemptLogin() {
        const username = document.getElementById('adminUsername').value;
        const password = document.getElementById('adminPassword').value;
        if (username === 'admin' && password === 'epic') {
          closeLoginModal();
          showAdminPanel();
        } else {
          document.getElementById('loginError').style.display = 'block';
          document.getElementById('adminPassword').value = '';
          document.getElementById('adminPassword').focus();
        }
      }

      document.addEventListener('keydown', function(event) {
        if (event.key === 'Enter' && document.getElementById('loginModal').style.display === 'block') {
          attemptLogin();
        }
      });

      function showAdminPanel() {
        document.getElementById('adminPanel').style.display = 'block';
        updateLocationCount();
        document.getElementById('adminPanel').scrollIntoView({ behavior: 'smooth' });
      }

      function hideAdmin() {
        document.getElementById('adminPanel').style.display = 'none';
        document.getElementById('rawDataDisplay').style.display = 'none';
      }

      function updateLocationCount() {
        const savedLocations = JSON.parse(localStorage.getItem('locationHistory')) || [];
        document.getElementById('locationCount').textContent = savedLocations.length;
      }

      function viewRawData() {
        const rawDisplay = document.getElementById('rawDataDisplay');
        const savedLocations = JSON.parse(localStorage.getItem('locationHistory')) || [];
        if (savedLocations.length === 0) {
          rawDisplay.innerHTML = 'No location data stored.';
        } else {
          rawDisplay.innerHTML = '<pre>' + JSON.stringify(savedLocations, null, 2) + '</pre>';
        }
        rawDisplay.style.display = rawDisplay.style.display === 'none' ? 'block' : 'none';
      }

      function clearAllData() {
        if (confirm('‚ö†Ô∏è WARNING: This will permanently delete ALL stored location data. Are you sure?')) {
          localStorage.removeItem('locationHistory');
          alert('All location data has been cleared.');
          updateLocationCount();
          document.getElementById('rawDataDisplay').style.display = 'none';
          markers.forEach(marker => marker.setMap(null));
          markers = [];
        }
      }
    </script>

    <script async defer src="https://maps.googleapis.com/maps/api/js?key=YOUR_API_KEY_HERE&callback=initMap"></script>
  </body>
</html>
