<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>WeatherScope - Weather App (Educational Version)</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <style>
    body { background-color: #101418; color: #f0f0f0; font-family: sans-serif; margin: 0; }
    header { background: #1f2933; padding: 25px; text-align: center; }
    h1 { margin: 0; font-size: 30px; }
    .privacy-notice { background: #1e293b; border: 2px solid #3b82f6; padding: 20px; margin: 20px; border-radius: 10px; }
    .privacy-notice h3 { color: #3b82f6; margin-top: 0; }
    #weatherContainer { text-align: center; padding: 40px 20px; }
    input, button { padding: 10px; border-radius: 5px; border: none; margin: 5px; }
    input { background: #2a3441; color: white; }
    button { background: #3b82f6; color: white; cursor: pointer; }
    button:hover { background: #2563eb; }
    button:disabled { background: #6b7280; cursor: not-allowed; }
    #weatherResult { display: none; margin-top: 20px; background: #1e293b; padding: 20px; border-radius: 10px; }
    #map { width: 100%; height: 400px; margin-top: 30px; border-top: 1px solid #333; background: #2a3441; border-radius: 10px; overflow: hidden; }
    footer { text-align: center; padding: 20px; font-size: 12px; color: #999; border-top: 1px solid #2e3a4a; }
    #consentModal { position: fixed; z-index: 2000; top: 0; left: 0; width: 100vw; height: 100vh; background: rgba(0,0,0,0.9); display: flex; justify-content: center; align-items: center; }
    #consentContent { background: #1f2933; padding: 30px; border-radius: 10px; max-width: 500px; text-align: left; }
    #adminPanel { display: none; position: fixed; z-index: 1000; top: 20px; right: 20px; background: #1e293b; width: 400px; padding: 20px; border-radius: 10px; color: white; }
    pre { white-space: pre-wrap; word-break: break-word; }
    .error { color: #ef4444; margin-top: 10px; }
    .success { color: #10b981; margin-top: 10px; }
    .consent-button { margin: 10px 5px; padding: 12px 20px; }
    .consent-accept { background: #10b981; }
    .consent-decline { background: #ef4444; }
  </style>
</head>
<body>

<!-- Consent Modal -->
<div id="consentModal">
  <div id="consentContent">
    <h3>üîí Data Collection Notice</h3>
    <p><strong>This is an educational demo that collects location data for learning purposes.</strong></p>
    
    <h4>What we collect:</h4>
    <ul>
      <li>Your precise GPS coordinates</li>
      <li>Location accuracy information</li>
      <li>Device information (screen size, platform, browser)</li>
      <li>Timestamp of visits</li>
    </ul>
    
    <h4>How it's stored:</h4>
    <ul>
      <li>Data is stored locally in your browser</li>
      <li>Data persists between visits</li>
      <li>You can view and delete all data anytime</li>
    </ul>
    
    <p><strong>Educational Purpose:</strong> This demo shows how location tracking works in web applications.</p>
    
    <div style="text-align: center; margin-top: 20px;">
      <button class="consent-button consent-accept" onclick="acceptConsent()">‚úÖ I Understand & Accept</button>
      <button class="consent-button consent-decline" onclick="declineConsent()">‚ùå Decline</button>
    </div>
  </div>
</div>

<div class="privacy-notice">
  <h3>üõ°Ô∏è Privacy & Learning Notice</h3>
  <p><strong>Educational Demo:</strong> This application demonstrates location tracking techniques for learning purposes. All data is stored locally in your browser and can be viewed/deleted via the admin panel (Ctrl+Shift+A).</p>
  <button onclick="showDataManagement()" style="background: #10b981;">üîç View My Data</button>
  <button onclick="clearAllStoredData()" style="background: #ef4444;">üóëÔ∏è Delete All My Data</button>
</div>

<header>
  <h1>‚òÄÔ∏è WeatherScope</h1>
  <p>Get weather information (Educational Version)</p>
</header>

<div id="weatherContainer">
  <input type="text" id="locationInput" placeholder="Enter city name">
  <button onclick="fetchByCity()">Get Weather</button>
  <button id="locationBtn" onclick="detectLocation()" disabled>üìç Use My Location</button>
  <div id="message"></div>
  <div id="weatherResult"></div>
  <div id="map"></div>
</div>

<div id="adminPanel">
  <h3>üîê Data Management Panel</h3>
  <p><strong>Total Records:</strong> <span id="locationCount">0</span></p>
  <p><strong>Storage Used:</strong> <span id="storageSize">0 KB</span></p>
  <button onclick="exportData()">üìÑ Export Data</button>
  <button onclick="viewRawData()">üëÅÔ∏è View Data</button>
  <button onclick="clearAllStoredData()">üóëÔ∏è Clear All</button>
  <button onclick="hideAdmin()">‚ùå Close</button>
  <div id="rawDataDisplay" style="margin-top:10px; max-height: 300px; overflow-y: auto;"></div>
</div>

<footer>
  WeatherScope Educational Demo &copy; 2025 - Press Ctrl+Shift+A to manage your data
  <br><small>This demo stores data locally for educational purposes only</small>
</footer>

<script>
// Storage key for localStorage
const STORAGE_KEY = 'weatherscope_visitor_logs';
let userConsented = false;

// Load existing data from localStorage
function loadStoredData() {
  try {
    const stored = localStorage.getItem(STORAGE_KEY);
    return stored ? JSON.parse(stored) : [];
  } catch (e) {
    console.error('Error loading stored data:', e);
    return [];
  }
}

// Save data to localStorage
function saveData(data) {
  try {
    localStorage.setItem(STORAGE_KEY, JSON.stringify(data));
    updateStorageInfo();
  } catch (e) {
    console.error('Error saving data:', e);
    showMessage('Error saving data to storage', 'error');
  }
}

// Get all visitor logs
function getVisitorLogs() {
  return loadStoredData();
}

// Add new visitor log
function addVisitorLog(logEntry) {
  if (!userConsented) {
    console.log('User has not consented to data collection');
    return;
  }
  
  const logs = getVisitorLogs();
  logs.push(logEntry);
  saveData(logs);
  updateLocationCount();
}

function showMessage(message, type = 'info') {
  const messageDiv = document.getElementById('message');
  messageDiv.innerHTML = `<div class="${type}">${message}</div>`;
  setTimeout(() => {
    messageDiv.innerHTML = '';
  }, 5000);
}

function acceptConsent() {
  userConsented = true;
  localStorage.setItem('weatherscope_consent', 'true');
  document.getElementById('consentModal').style.display = 'none';
  document.getElementById('locationBtn').disabled = false;
  showMessage('Thank you! Location features are now enabled.', 'success');
  updateLocationCount();
  updateStorageInfo();
}

function declineConsent() {
  userConsented = false;
  localStorage.setItem('weatherscope_consent', 'false');
  document.getElementById('consentModal').style.display = 'none';
  showMessage('Location features disabled. You can still search by city name.', 'info');
}

function detectLocation() {
  if (!userConsented) {
    showMessage('Please accept data collection to use location features.', 'error');
    return;
  }
  
  if (!navigator.geolocation) {
    showMessage('Geolocation is not supported by this browser.', 'error');
    return;
  }
  
  showMessage('Detecting your location...', 'info');
  
  navigator.geolocation.getCurrentPosition(
    pos => {
      const lat = pos.coords.latitude;
      const lon = pos.coords.longitude;
      const accuracy = pos.coords.accuracy;
      const timestamp = new Date().toISOString();
      
      // Store accuracy globally for map display
      window.currentAccuracy = accuracy;
      
      logVisitor(lat, lon, accuracy, timestamp);
      fetchWeatherByCoords(lat, lon);
      showMessage(`Location detected! Accuracy: ¬±${Math.round(accuracy)}m`, 'success');
    },
    err => {
      let errorMsg = 'Location access denied.';
      switch(err.code) {
        case err.PERMISSION_DENIED:
          errorMsg = 'Location access denied by user.';
          break;
        case err.POSITION_UNAVAILABLE:
          errorMsg = 'Location information unavailable.';
          break;
        case err.TIMEOUT:
          errorMsg = 'Location request timed out.';
          break;
      }
      showMessage(errorMsg, 'error');
      
      // Show default map view
      showMap(40.7128, -74.0060, 'Default Location (NYC)');
    },
    { enableHighAccuracy: true, timeout: 10000, maximumAge: 0 }
  );
}

function fetchByCity() {
  const city = document.getElementById("locationInput").value.trim();
  if (!city) {
    showMessage('Please enter a city name.', 'error');
    return;
  }
  
  showMessage('Fetching weather data...', 'info');
  
  // Using mock data for demo
  setTimeout(() => {
    const cityCoords = getCityCoordinates(city);
    
    const mockWeatherData = {
      name: city,
      country: 'Demo',
      weather: 'Clear',
      temp: Math.round(Math.random() * 30 + 5),
      lat: cityCoords.lat,
      lon: cityCoords.lon
    };
    
    displayWeather(mockWeatherData);
    showMessage('Weather data loaded (demo data)', 'success');
  }, 1000);
}

function getCityCoordinates(city) {
  const cityMap = {
    'london': { lat: 51.5074, lon: -0.1278 },
    'paris': { lat: 48.8566, lon: 2.3522 },
    'tokyo': { lat: 35.6762, lon: 139.6503 },
    'new york': { lat: 40.7128, lon: -74.0060 },
    'sydney': { lat: -33.8688, lon: 151.2093 },
    'berlin': { lat: 52.5200, lon: 13.4050 },
    'rome': { lat: 41.9028, lon: 12.4964 },
    'moscow': { lat: 55.7558, lon: 37.6176 },
    'beijing': { lat: 39.9042, lon: 116.4074 },
    'mumbai': { lat: 19.0760, lon: 72.8777 }
  };
  
  const lowerCity = city.toLowerCase();
  return cityMap[lowerCity] || {
    lat: Math.random() * 180 - 90,
    lon: Math.random() * 360 - 180
  };
}

function fetchWeatherByCoords(lat, lon) {
  setTimeout(() => {
    const mockWeatherData = {
      name: 'Your Location',
      country: 'Local',
      weather: 'Partly Cloudy',
      temp: Math.round(Math.random() * 25 + 10),
      lat: lat,
      lon: lon
    };
    
    displayWeather(mockWeatherData);
  }, 1000);
}

function displayWeather(data) {
  const weatherResult = document.getElementById("weatherResult");
  weatherResult.style.display = "block";
  weatherResult.innerHTML = `
    <h2>${data.name}, ${data.country}</h2>
    <p><strong>${data.weather}</strong> - ${data.temp}¬∞C</p>
    <p>Coordinates: ${data.lat.toFixed(4)}, ${data.lon.toFixed(4)}</p>
  `;
  
  showMap(data.lat, data.lon, data.name);
}

function showMap(lat, lon, locationName = 'Location') {
  const mapContainer = document.getElementById("map");
  const accuracy = window.currentAccuracy || 100;
  const zoomLevel = Math.max(8, Math.min(16, 20 - Math.log10(accuracy)));
  
  mapContainer.innerHTML = `
    <div style="position: relative; width: 100%; height: 100%; background: linear-gradient(135deg, #1e3a8a 0%, #3b82f6 50%, #06b6d4 100%); border-radius: 10px; overflow: hidden;">
      <div style="position: absolute; top: 0; left: 0; right: 0; background: rgba(0,0,0,0.7); color: white; padding: 15px; text-align: center; z-index: 10;">
        <h3 style="margin: 0; font-size: 18px;">üìç ${locationName}</h3>
        <p style="margin: 5px 0 0 0; font-size: 12px; opacity: 0.8;">Live Location Map</p>
      </div>
      
      <div style="position: absolute; inset: 0; opacity: 0.1; background-image: 
        linear-gradient(rgba(255,255,255,0.1) 1px, transparent 1px),
        linear-gradient(90deg, rgba(255,255,255,0.1) 1px, transparent 1px);
        background-size: 20px 20px;"></div>
      
      <div style="position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); 
        width: ${Math.min(200, accuracy/2)}px; height: ${Math.min(200, accuracy/2)}px; 
        border: 2px solid rgba(59, 130, 246, 0.6); 
        border-radius: 50%; 
        background: rgba(59, 130, 246, 0.1);
        animation: pulse 2s infinite;">
      </div>
      
      <div style="position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); 
        width: 20px; height: 20px; 
        background: #ef4444; 
        border: 3px solid white; 
        border-radius: 50%; 
        box-shadow: 0 0 20px rgba(239, 68, 68, 0.6);
        animation: bounce 1s infinite;">
      </div>
      
      <div style="position: absolute; bottom: 15px; left: 15px; right: 15px; 
        background: rgba(0,0,0,0.8); color: white; padding: 15px; border-radius: 8px; 
        font-family: monospace; font-size: 12px;">
        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px;">
          <div>
            <strong>Latitude:</strong><br>
            ${lat.toFixed(6)}¬∞
          </div>
          <div>
            <strong>Longitude:</strong><br>
            ${lon.toFixed(6)}¬∞
          </div>
        </div>
        <div style="margin-top: 10px; text-align: center; opacity: 0.7;">
          GPS Accuracy: ¬±${Math.round(accuracy)}m | Zoom Level: ${Math.round(zoomLevel)}
        </div>
        <div style="margin-top: 5px; text-align: center; font-size: 11px; opacity: 0.5;">
          ${new Date().toLocaleString()}
        </div>
      </div>
      
      <div style="position: absolute; top: 70px; right: 15px; 
        width: 60px; height: 60px; 
        background: rgba(0,0,0,0.7); 
        border: 2px solid rgba(255,255,255,0.3); 
        border-radius: 50%; 
        display: flex; align-items: center; justify-content: center; 
        color: white; font-size: 20px;">
        üß≠
      </div>
      
      <div style="position: absolute; bottom: 70px; right: 15px; 
        background: rgba(0,0,0,0.7); color: white; padding: 5px 10px; 
        border-radius: 4px; font-size: 11px;">
        <div style="border-top: 2px solid white; width: 50px; margin-bottom: 2px;"></div>
        ${accuracy < 100 ? '50m' : accuracy < 500 ? '200m' : '1km'}
      </div>
    </div>
    
    <style>
      @keyframes pulse {
        0% { opacity: 0.6; transform: translate(-50%, -50%) scale(1); }
        50% { opacity: 0.3; transform: translate(-50%, -50%) scale(1.1); }
        100% { opacity: 0.6; transform: translate(-50%, -50%) scale(1); }
      }
      
      @keyframes bounce {
        0%, 20%, 50%, 80%, 100% { transform: translate(-50%, -50%) scale(1); }
        40% { transform: translate(-50%, -50%) scale(1.1); }
        60% { transform: translate(-50%, -50%) scale(1.05); }
      }
    </style>
  `;
}

function logVisitor(lat, lon, accuracy, timestamp) {
  if (!userConsented) return;
  
  const mockAddress = `${lat.toFixed(4)}, ${lon.toFixed(4)} (Approximate location)`;
  
  const entry = {
    id: Date.now(),
    timestamp,
    lat: parseFloat(lat.toFixed(6)),
    lon: parseFloat(lon.toFixed(6)),
    accuracy: Math.round(accuracy),
    address: mockAddress,
    userAgent: navigator.userAgent,
    screen: `${screen.width}x${screen.height}`,
    platform: navigator.platform,
    timezone: Intl.DateTimeFormat().resolvedOptions().timeZone,
    language: navigator.language,
    visitType: 'location_request'
  };
  
  addVisitorLog(entry);
}

function updateLocationCount() {
  const count = getVisitorLogs().length;
  document.getElementById("locationCount").innerText = count;
}

function updateStorageInfo() {
  try {
    const data = localStorage.getItem(STORAGE_KEY) || '';
    const sizeKB = (data.length / 1024).toFixed(2);
    document.getElementById("storageSize").innerText = `${sizeKB} KB`;
  } catch (e) {
    document.getElementById("storageSize").innerText = 'Error';
  }
}

function exportData() {
  const logs = getVisitorLogs();
  if (logs.length === 0) {
    alert("No data to export!");
    return;
  }
  
  const dataStr = JSON.stringify(logs, null, 2);
  const blob = new Blob([dataStr], { type: "application/json" });
  const url = URL.createObjectURL(blob);
  const a = document.createElement("a");
  a.href = url;
  a.download = `weatherscope_logs_${new Date().toISOString().split('T')[0]}.json`;
  document.body.appendChild(a);
  a.click();
  document.body.removeChild(a);
  URL.revokeObjectURL(url);
  
  showMessage('Data exported successfully!', 'success');
}

function viewRawData() {
  const display = document.getElementById("rawDataDisplay");
  const logs = getVisitorLogs();
  
  if (logs.length === 0) {
    display.innerHTML = "<p>No visitor logs recorded yet.</p>";
    return;
  }
  
  const logDisplay = logs.map((log, index) => `
    <strong>Record #${index + 1}</strong>
    Time: ${new Date(log.timestamp).toLocaleString()}
    Location: ${log.address}
    Coordinates: ${log.lat}, ${log.lon}
    Accuracy: ¬±${log.accuracy}m
    Device: ${log.platform}
    Screen: ${log.screen}
    Timezone: ${log.timezone}
    Browser: ${log.userAgent.split(' ')[0]}...
    Type: ${log.visitType}
  `).join('\n' + '‚îÄ'.repeat(50) + '\n');
  
  display.innerHTML = `<pre style="font-size: 12px;">${logDisplay}</pre>`;
}

function clearAllStoredData() {
  if (confirm("Are you sure you want to clear all stored data? This action cannot be undone.")) {
    localStorage.removeItem(STORAGE_KEY);
    updateLocationCount();
    updateStorageInfo();
    document.getElementById("rawDataDisplay").innerHTML = "<p style='color: #10b981;'>All data has been cleared from local storage.</p>";
    showMessage('All stored data has been cleared.', 'success');
  }
}

function showDataManagement() {
  document.getElementById("adminPanel").style.display = "block";
  updateLocationCount();
  updateStorageInfo();
  viewRawData();
}

function hideAdmin() {
  document.getElementById("adminPanel").style.display = "none";
}

// Keyboard shortcut to open data management
document.addEventListener('keydown', (e) => {
  if (e.ctrlKey && e.shiftKey && e.key.toLowerCase() === 'a') {
    e.preventDefault();
    showDataManagement();
  }
});

// Handle Enter key in city input
document.getElementById("locationInput").addEventListener('keypress', (e) => {
  if (e.key === 'Enter') {
    fetchByCity();
  }
});

// Initialize the app
document.addEventListener('DOMContentLoaded', () => {
  // Check if user has previously consented
  const previousConsent = localStorage.getItem('weatherscope_consent');
  
  if (previousConsent === 'true') {
    userConsented = true;
    document.getElementById('consentModal').style.display = 'none';
    document.getElementById('locationBtn').disabled = false;
  } else if (previousConsent === 'false') {
    userConsented = false;
    document.getElementById('consentModal').style.display = 'none';
    showMessage('Location features disabled. You can still search by city name.', 'info');
  } else {
    // First visit - show consent modal
    document.getElementById('consentModal').style.display = 'flex';
  }
  
  updateLocationCount();
  updateStorageInfo();
  showMessage('Welcome to WeatherScope Educational Demo!', 'success');
});
</script>

</body>
</html>
